<!DOCTYPE html>
<html><head>
<link rel="apple-touch-startup-image" href="css/smt/bg.png"/>
<link rel="apple-touch-icon" href="css/smt/screen-icon.png"/>
<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=0"/>
<meta name="apple-mobile-web-app-capable" content="yes"/><meta name="apple-mobile-web-app-status-bar-style" content="black"/>
<title>Tagbum Mobile</title>
<link rel="icon" href="css/smt/favicon.ico" type="image/png"/>
<link rel="stylesheet" href="css/jquery.mobile.custom.css"/>
<link rel="stylesheet" href="css/jquery.mobile-1.3.2.css"/>
<link rel="stylesheet" href="css/jquery.Jcrop.css"/>
<link rel="stylesheet" href="css/iScroll.css"/>
<link rel="stylesheet" href="css/ptrScroll.css"/>
<link rel="stylesheet" href="css/farbtastic.css"/>
<link rel="stylesheet" href="css/seemytag.css"/>
<link rel="stylesheet" href="css/colorPicker.css"/>
<script src="cordova.js"></script>
<!--<script src="http://debug.build.phonegap.com/target/target-script-min.js#82ad4bcc-195f-11e3-af04-22000a98b3d6"></script><!-- -->
<script src="js/core/const.js"></script>
<script src="js/core/md5.js"></script>
<script src="js/core/jquery-1.10.2.min.js"></script>
<script src="js/core/jquery.cookie.js"></script>
<script src="js/core/jquery.local.js"></script>
<script src="js/core/session.js"></script>
<script src="js/core/jquery.mobile-1.3.2.js"></script>
<script src="js/core/jquery.form.js"></script>
<script src="js/core/jquery.textCounter.js"></script>
<script src="js/core/jquery.Jcrop.js"></script>
<script src="js/core/iScroll.js"></script>
<script src="js/core/jScroll.js"></script>
<script src="js/core/farbtastic.js"></script>
<script src="js/core/colorPicker.js"></script>
<script src="js/app.js"></script>
<script src="js/min.js"></script>
</head><body><script>
//$.session('countpage',0);
if($.session('_post_')){
$.session('_post_',null);
window.location.reload();
}
</script>
<div id="page-timeLine" data-role="page" data-cache="false">
<div data-role="header" data-theme="f" data-position="fixed">
<div style="position:absolute;top:0px;left:0;padding:0 5px;">
<!--<a href="myMenu" style="position:relative;"><span class="btn-menu"></span><span class="push-notifications button" style="display:none;">0</span></a>-->
<a href="#" class="showMenu" style="position:relative;"><span class="btn-menu showMenu"></span><span class="push-notifications button" style="display:none;">0</span></a>
<a href="#" onclick="redir(PAGE['newtag'])"><img src="img/creation.png" /></a>
</div>
<h1><span class="loader"></span></h1>
<div id="userPoints" class="ui-btn-right" data-iconshadow="true" data-wrapperels="span">
<span class="loader"></span>
</div>
<fieldset id="private-select" data-role="controlgroup" data-type="horizontal" data-mini="true" style="position:absolute;top:7px;right:5px;display:none;">
<input id="radio-inbox" type="radio" name="radio-in-out" data-theme="a" value="in" checked="checked"/>
<input id="radio-outbox" type="radio" name="radio-in-out" data-theme="a" value="out"/>
</fieldset>
</div>
<div data-role="content">
<div id="pd-wrapper">
<div id="scroller">
<div id="pullDown"><div class="smt-tag-content"><span class="pullDownIcon"></span><span class="pullDownLabel"></span></div></div>
<div id="tagsList" class="cursor tags-list" style="min-height:300px;background:#fff;"></div>
<div id="pullUp"><div class="smt-tag-content"><span class="pullUpIcon"></span><span class="pullUpLabel"></span></div></div>
</div>
</div>
</div>
<div id="tl-footer" data-role="footer" data-position="fixed" data-theme="f">
<div data-role="navbar"><ul></ul></div>
</div>
<script>
var page = $.local('timeLine');
var active_tab = 'timeLine';
if (page) active_tab = page.last_tab;
//if(navigator.app) navigator.app.clearHistory();

pageShow({
id:'page-timeLine',
title:'Time Line',
before:function(){
$('.pullDownLabel').html(lan('SCROLL_PULLDOWN'));
$('.pullUpLabel').html(lan('SCROLL_PULLUP'));
$('#userPoints').html(lan('POINTS_USERS')+' <b><loader/></b>');
$('#tl-footer ul').html(//llenado de footer
'<li><a opc="timeLine" data-icon="tag-tl" data-iconpos="top" class="ui-btn-active">'+lang.JS_TIMELINE+'</a></li>'+
'<li><a opc="myTags" data-icon="tag-mt" data-iconpos="top">'+lang.JS_MYTAGS+'</a></li>'+
'<li><a opc="favorites" data-icon="tag-ft" data-iconpos="top">'+lang.JS_FAVORITETAGS+'</a></li>'+
'<li><a opc="privateTags" data-icon="tag-pt" data-iconpos="top">'+lang.JS_PRIVATETAGS+'</a></li>'
);
$('#private-select').append(
'<label for="radio-inbox">'+lan('inbox','ucw')+'</label>'+
'<label for="radio-outbox">'+lan('outbox','ucw')+'</label>'
);
},
after:function(){
if (active_tab != 'timeLine') {
$('#tl-footer ul li a').removeClass('ui-btn-active');
$('#tl-footer ul li a[opc='+active_tab+']').addClass('ui-btn-active');
if(active_tab=='privateTags'){
$('#private-select').show();
$('#userPoints').hide();
}else{
$('#private-select').hide();
$('#userPoints').show();
}
}
var opc={ 
current: active_tab,
layer:$('#tagsList')[0]
},
$wrapper=$('#pd-wrapper',this.id);
$('.ui-page-active .ui-title').html(lang.TIMELINE_TITLE);
$(opc.layer).on('click','.smt-tag',function(){
redir(PAGE['tag']+'?id='+$(this).attr('tag'));
});

$(opc.layer).doubletap('[tag]', function(e){
var tagId = $(e.currentTarget).attr('tag')
myAjax({
type:'GET',
url:DOMINIO+'controls/tags/actionsTags.controls.php?action=4&tag='+tagId,
dataType:'html',
success:function( data ){
console.log(e.currentTarget)
$(e.currentTarget).find('#dislikeIcon').fadeOut('slow',function(){
$(e.currentTarget).find('#likeIcon').fadeIn('slow');
});
}
});
});

// $(opc.layer).on('click','[tag]',function(){
// redir(PAGE['tag']+'?id='+$(this).attr('tag'));
// });
function dialogComment(id){
var opc={//comment data
layer:'#comments',
scroller:'.fs-wrapper',
data:{
type:4,
source:id,
limit:10,
mobile:1
},
likes:0,
dislikes:0
};
console.log('dialogComment. id='+id);
myDialog({
id:'#commentDialog',
style:{'margin-right':10},
content:
'<div style="padding:10px;"><textarea name="txtComment" id="txtComment" class="ui-input-text ui-body-c ui-corner-all ui-shadow-inset"'+
'style="resize:none;width:100%" rows="5" placeholder="'+lang.COMMENTS_LBLHELPIMPUTNEWCOMMENT+'"></textarea></div>',
buttons:[{
name:lang.send,
action:function(){
var comment=$.trim($('#txtComment').val());
if(comment!=''&&comment!=lang.COMMENTS_LBLHELPIMPUTNEWCOMMENT){
//comment = limpiaTextComentarios(comment);
var $this=$(this);
opc.complete=function(){$this.close();};
insertComment(comment,opc);
}
$('#commentDialog .closedialog').click();
$('.fs-wrapper').jScroll('refresh');
}
},{
name:lang.close,
action:'close'
}]
});
}
function afterAjax(data, tagId, toHide,toShow){
console.log('tagID:'+tagId+'--'+toHide+'--'+toShow);
if(data.indexOf('ERROR')<0){
$('[tag='+tagId+']').find(toHide).fadeOut('slow',function(){
$('[tag='+tagId+']').find(toShow).fadeIn('slow');
});
}
}
$(opc.layer).on('click', 'menu li', function(e){
var tagtId = $(e.target).parents('[tag]').attr('tag');
var btnPresed = e.target.id;
switch(e.target.id){
case 'report':redir(PAGE['reporttag']+'?id='+tagtId);break;
case 'share':redir(PAGE['sharetag']+'?id_tag='+tagtId);break;
case 'comment':dialogComment(tagtId);break;
case 'like':case 'dislike':
var that=e.target.id+'Icon',
show=e.target.id!='like'?'likeIcon':'dislikeIcon';
myAjax({
type:'POST',
url:DOMINIO+'controls/tags/actionsTags.controls.php?action='+(that=='likeIcon'?4:11)+'&tag='+tagtId,
dataType:'html',
success:function( data ){
afterAjax(data,tagtId,'.tag-icons #'+show,'.tag-icons #'+that);
myAjax({
type:'POST',
url:DOMINIO+'controls/tags/actionsTags.controls.php?action=12&tag='+tagtId,
dataType:'html',
success:function( data ){
data= data.split('|');
// opc.likes=data[0];
// opc.dislikes=data[1];
if(data[2]>0){afterAjax(data, tagtId, 'menu #like', 'menu #dislike');};
if(data[2]<0){afterAjax(data, tagtId,'menu #dislike', 'menu #like');};
// $('#numLikes').html(opc.likes);
// $('#numDislikes').html(opc.dislikes);
}
});
}
});
break;
case 'redistr':
myAjax({
type:'POST',
url:DOMINIO+'controls/tags/actionsTags.controls.php?action=3&tag='+tagtId,
dataType:'html',
success:function( data ){
afterAjax(data, tagtId,'menu #redistr', '.tag-icons #redist');
}
});
break;
case 'delete':
//var url=$_GET['idGroup']?(PAGE['tagslist']+'?current=group&id='+$_GET['idGroup']):PAGE['timeline'];
myDialog({
id:'#singleRedirDialog',
content:lang.JS_DELETETAG,
buttons:[{
name:lang.yes,
action:function(){
myAjax({
type: 'POST',
url: DOMINIO+'controls/tags/actionsTags.controls.php?action=6&tag='+tagtId,
dataType: 'html',
success: function( data ) {
//redir(url);
}
});
}
},{
name:'No',
action:'close'
}]
});
break;
}
});

$wrapper.ptrScroll({
onPullDown:function(){
updateTags('reload',opc);
},
onPullUp:function(){
var response = updateTags('more',opc);
if (!response) {
$wrapper.jScroll('refresh');
};
},
onReload:function(){
updateTags('reload',opc,true);
}
});
var priv='',val='in';
$('#private-select input').click(function(){
if(val!=this.value){
val=this.value;
priv=val=='out'?'&type=outbox':'';
opc.get=priv;
$wrapper.ptrScroll('reload');
}
});
$('#tl-footer ul').on('click','a',function(){
var c=$(this).attr('opc');
$.local('timeLine', {'last_tab':c});
if(opc.current!=c){
opc.current=c;
if(opc.current=='privateTags'){
opc.get=priv;
$('#private-select').show();
$('#userPoints').hide();
}else{
// opc.get='';
$('#private-select').hide();
$('#userPoints').show();
}
delete opc.on;
$wrapper.ptrScroll('reload');
}
});
$('#userPoints').click(function(){
myDialog({
id:'msg-points',
open:true,
content:
'<p>'+lang.MAINMENU_POINTS_2+'</p>'+
'<p>'+lang.MAINMENU_POINTS_1+'</p>',
style:{
'margin':10,
'font-size':14
}
});
});
//Get User Points
$.ajax({
type :'GET',
url :DOMINIO+'controls/users/getUserPoints.json.php',
dataType:'json',
success :function(data){
var datos='',pts='';
pts=data.split(' ');
//alert(pts[1]);
if(pts[1]=='CONST_UNITMIL')
datos=pts[0]+' K';
else if(pts[1]=='CONST_UNITMILLON')
datos=pts[0]+' M';
else
datos=data;
$('#userPoints b').html(datos);
}
});
}
});
</script>
</div>
</body></html>
