<!DOCTYPE html>
<html><head>
<link rel="apple-touch-startup-image" href="css/smt/bg.png"/>
<link rel="apple-touch-icon" href="css/smt/screen-icon.png"/>
<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=0"/>
<meta name="apple-mobile-web-app-capable" content="yes"/><meta name="apple-mobile-web-app-status-bar-style" content="black"/>
<title>Tagbum Mobile</title>
<link rel="icon" href="css/smt/favicon.ico" type="image/png"/>
<link rel="stylesheet" href="css/jquery.mobile.custom.css"/>
<link rel="stylesheet" href="css/jquery.mobile-1.3.2.css"/>
<link rel="stylesheet" href="css/jquery.Jcrop.css"/>
<link rel="stylesheet" href="css/iScroll.css"/>
<link rel="stylesheet" href="css/ptrScroll.css"/>
<link rel="stylesheet" href="css/farbtastic.css"/>
<link rel="stylesheet" href="css/seemytag.css"/>
<link rel="stylesheet" href="css/colorPicker.css"/>
<script src="cordova.js"></script>
<!--<script src="http://debug.build.phonegap.com/target/target-script-min.js#82ad4bcc-195f-11e3-af04-22000a98b3d6"></script><!-- -->
<script src="js/core/const.js"></script>
<script src="js/core/md5.js"></script>
<script src="js/core/jquery-1.10.2.min.js"></script>
<script src="js/core/jquery.cookie.js"></script>
<script src="js/core/jquery.local.js"></script>
<script src="js/core/session.js"></script>
<script src="js/core/jquery.mobile-1.3.2.js"></script>
<script src="js/core/jquery.form.js"></script>
<script src="js/core/jquery.textCounter.js"></script>
<script src="js/core/jquery.Jcrop.js"></script>
<script src="js/core/iScroll.js"></script>
<script src="js/core/jScroll.js"></script>
<script src="js/core/farbtastic.js"></script>
<script src="js/core/colorPicker.js"></script>
<script src="js/min.js"></script>
</head><body><div id="page-profile" data-role="page" data-cache="false">
<div data-role="header" data-position="fixed" data-theme="f"><h1></h1></div>
<div data-role="content" data-theme="d" class="no-footer">
<img class="bg" src="img/bg.png" />
<div id="fs-wrapper" class="fs-wrapper">
<div id="scroller">
<div>
<div style="height:60px;margin:19px;">
<img id="userPicture" style="float:left;height:60px;width:60px;" class="userBR" />
<div id="userInfo" style="float:left;margin-left:13px;"></div>
</div>
<a id="pictureButton" style="display:none;" data-role="button" data-theme="c">&nbsp;</a>
<div id="globalButtons">
<div id="userFriends" data-role="button" data-theme="c">&nbsp;</div>
<div id="userFollowers" data-role="button" data-theme="c">&nbsp;</div>
<div id="userFollowing" data-role="button" data-theme="c">&nbsp;</div>
<div id="userTags" data-role="button" data-theme="c">&nbsp;</div>
<div id="userPersonalTags" data-role="button" data-theme="c">&nbsp;</div>
<div id="userPreferences" data-role="button" data-theme="c">&nbsp;</div>
</div>
<a id="followButton" style="display:none;" data-role="button" data-theme="e" data-icon="plus" data-iconpos="right" style="margin-top:25px;">&nbsp;</a>
</div>
<div id="error"></div>
</div>
</div>
</div>
<script>
pageShow({
id:'#page-profile',
buttons:{back:true,home:true},
title:lang.USER_PROFILE,
before:function(){
function buttonText(id,text){ $(id).html(text+' (<b><loader/></b>)'); }
$('#userInfo').html(
'<div><strong><loader/></strong></div>'+
'<div><strong>'+lang.PROFILE_BIRTHDATE+':</strong> <loader/></div>'+
'<div><strong>'+lan('From')+':</strong> <loader/></div>'
);
buttonText('#userFriends',lan('friends','ucw'));
buttonText('#userFollowers',lan('admirers','ucw'));
buttonText('#userFollowing',lan('admired','ucw'));
buttonText('#userTags','Tags');
$('#userPicture').attr('src',FILESERVER+'img/users/default.png');
buttonText('#userPersonalTags',lang.PROFILE_PERSONALTAGS);
$('#userPreferences').html(lang.USERPROFILE_PREFERENCES_TITLE);
$('#pictureButton').html(lan(CORDOVA?'change picture':'edit thumbnail','ucw'));
},
after:function(){
var code=$_GET['id']||$.local('code'),
me=(code==$.local('code'));//me=true si es el perfil del usuario loggeado
$('.fs-wrapper').jScroll({hScroll:false});
function loadProfile(data){
console.log('load profile');
console.log(data);
//cambia el tema de los botones (solo funciona con botones)
function changeButtonTheme(theme,obj){
$(obj)
.attr('data-theme',theme)
.removeClass(function(index,list){
var matches=list.match(/ui-btn-(up|hover)-./g) || [];
return (matches.join(' '));
}).addClass('ui-btn-up-'+theme);
}
//esta funcion define tema y texto del boton follow/unfollow
function setFollowButton(follow){
var theme='e',text=lang.follow,icon='ui-icon-plus';
if(follow){
theme='a';
text=lang.unfollow;
icon='ui-icon-minus';
}
changeButtonTheme(theme,'#followButton');
$('#followButton .ui-btn-text').html(text);
$('#followButton .ui-icon').removeClass('ui-icon-plus ui-icon-minus').addClass(icon);
}
//funcion para llenar el numero de los botones con numeracion
function fillButton(button,num){
//if(!num>0) changeButtonTheme('a',button);
if(num>0)
$(button).attr('num',num);
else
$(button).removeAttr('num');
if(num===undefined||num===null||num<0) num='<loader/>';
$('.ui-btn-text b',button).html(num||0);
}
function setFriendsButtons(data){data=data||{};
fillButton('#userFriends', data['friends_count']?data['friends_count']:data['friends']);
fillButton('#userFollowers',data['followers_count']?data['followers_count']:data['admirers']);
fillButton('#userFollowing',data['following_count']?data['following_count']:data['admired']);
}
setFriendsButtons(data);
fillButton('#userTags', data['numTags']);
fillButton('#userPersonalTags', data['numPersTags']);
if(data['photo_friend']) $('#userPicture').attr('src',data['photo_friend']);

var birth=lan(data['birthday'],'ucw'),
txt='<div><strong>'+(data['username']||'')+'</strong></div>';
if(data['type']=='0')
txt+=(birth!='none'?'<div><strong>'+lang.PROFILE_BIRTHDATE+':</strong> '+birth+'</div>':'');
else
txt+=(data['birthday']!='none'?'<div><strong>'+lang.FOUNDATION_DATE+':</strong> '+data['birthday']+'</div>':'');
txt+=(data['country']!='none'?'<div><strong>'+lan('From')+':</strong> '+data['country']+'</div>':'');
$('#userInfo').html(txt);
$('.fs-wrapper').jScroll('refresh');
$('#globalButtons').on('click','div',function(){
if($(this).attr('num')>0){
switch(this.id){
case 'userFriends': redir(PAGE['userfriends']+'?type=friends&id_user='+code); break;
case 'userFollowers': redir(PAGE['userfriends']+'?type=follow&id_user='+code); break;
case 'userFollowing': redir(PAGE['userfriends']+'?type=unfollow&id_user='+code); break;
case 'userTags': redir(PAGE['tagslist']+'?current=tagsUser&id='+md5(data['id'])); break;
case 'userPersonalTags': redir(PAGE['tagslist']+'?current=personalTags&id='+md5(data['id'])); break;
}
}
});
$('#userPreferences').click(function(){
if(me) redir(PAGE['preferences']);
else preferencesUsers(code);
});
if(me){
$('#followButton').remove();
if (CORDOVA)
if(data['photo_friend']){
$('#pictureButton').fadeIn('slow').click(function(){
redir(PAGE['profilepic']);
});
}
else $('#pictureButton').remove();
}else{
$('#pictureButton').remove();
var $follow=$('#followButton');
setFollowButton(data['follow']);
$follow.fadeIn('slow').click(function(){
setFriendsButtons({});
myAjax({
type:'GET',
url:DOMINIO+'controls/users/follow.json.php?uid='+md5(data['id']),
error:function() {
console.log('follow button ERROR');
},
success:function(data){
if(!data['error']){
setFriendsButtons(data['friend']);
$follow.fadeOut('slow', function () {
setFollowButton(!data['unlink']);//si get esta vacio, se hizo seguidos
$follow.fadeIn('slow');
});
}
}
});
});
}
}
myAjax({
url:DOMINIO+'controls/users/people.json.php?action=specific&code',
data:{uid:code},
success:function(data){
console.log('success '+data['datos'][0]['username']);
loadProfile(data['datos'][0]);
},
error:function(){
console.log('error');
}
});
}
});
</script>
</div>
</body></html>
